<html>
	<head>
		<link rel="stylesheet" type="text/css" href="/css/reset.css">
		<link rel="stylesheet" type="text/css" href="/css/responsive.css">
		<link rel="stylesheet" type="text/css" href="/css/game.css">
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<div id="app" v-bind:class="{[display]:true}">
			<div class="content">
				<transition name="blobSwitch">
					<div v-if="state == 'dashboard'">
						<header>
							<img v-bind:title="user.address.toLowerCase()" v-on:mousedown="tool = ''" style="cursor:pointer;" class="avatar" v-bind:src="window.avatars.api(user.address)"/>
							<button v-if="tool" v-on:mousedown="(tool.indexOf('_') > -1 ? tool = tool.split('_')[0] : tool = '')">Back</button>
							<button style="float:right" v-on:mousedown="logout">üîí Lock</button>
						</header>
						<transition name="blobSwitch">
							<main v-if="!tool">
								<ul class="toolbox">
									<h1>What would you like to do?</h1>
									<li v-on:mousedown="tool = 'remtool'" class="tool">
										<div class="icon">‚è≤</div>
										<h2>
											REM Tracker
										</h2>
										<p>
											Your companion tool for REM tracking
										</p>
									</li>
									<li class="tool" onclick="window.open('https://t.me/luciddreamchat','_blank')">
										<div class="icon">üí¨</div>
										<h2>
											Chat
										</h2>
										<p>
											Chat about lucid dreaming efforts!
										</p>
									</li>
									<li class="tool" onclick="window.open('https://thelucidguide.com/forum','_blank')">
										<div class="icon">‚å®Ô∏è</div>
										<h2>
											Forum
										</h2>
										<p>
											Discuss all things dreaming
										</p>
									</li>
									<li v-on:mousedown="setQR(); tool = 'settings'" class="tool">
										<div class="icon">‚öôÔ∏è</div>
										<h2>
											Settings
										</h2>
										<p>
											Get QR access code, update preferences and more
										</p>
									</li>
								</ul>
							</main>
						</transition>
						<transition name="blobSwitch">
							<main v-if="tool == 'remtool'">
								<ul class="toolbox">
									<h1>Under construction</h1>
									<br/><li v-on:mousedown="tool = ''" class="tool" style="outline:2px solid #fafafa;">Back</li>
								</ul>
							</main>
						</transition>
						<transition name="blobSwitch">
							<main v-if="tool == 'settings'">
								<ul class="toolbox">
									<h1>QR Code</h1>
									<p style="color:#fafafa;">Scan with your mobile device to access your account there as well</p>
									<img class="slowStart" id="qrcode_generated" style="padding:64px; background:#fafafa; margin-bottom:32px;" v-bind:src="qrBlob"/>
									<br/><li v-on:mousedown="downloadEnc()" class="tool" style="outline:2px solid #fafafa;">Download</li>
									<br/><li v-on:mousedown="tool = ''" class="tool" style="outline:2px solid #fafafa;">Back</li>
								</ul>
							</main>
						</transition>
					</div>
				</transition>
				<transition name="blobSwitch">
					<div v-if="state == 'loading'">
						<h1>
							Loading...
						</h1>
						<p>
							{{status}}
						</p>
					</div>
				</transition>
				<transition name="blobSwitch">
					<div v-if="state == 'decryptWallet'">
						<h1>Please enter your password</h1>
						<p>Your avatar is <img v-bind:title="user.address.toLowerCase()" v-on:mousedown="tool = ''" style="cursor:pointer;" class="avatar" v-bind:src="window.avatars.api(user.address)"/></p>
						<input v-on:keyup.enter="decryptWallet" id="decryptPassword" placeholder="Type a password" type="password"/>
						<span class="error">{{error}}</span>
						<button v-on:mousedown="decryptWallet">üîì Unlock</button>
						<button class="danger slowStart" v-on:mousedown="state = 'confirmForget'">Forget</button>
					</div>
				</transition>
				<transition name="blobSwitch">
					<div  v-if="state == 'encryptNewWallet'">
						<h1>It's not safe to go without a password!</h1>
						<p>Your avatar will be <img v-bind:title="user.address.toLowerCase()" v-on:mousedown="tool = ''" style="cursor:pointer;" class="avatar" v-bind:src="window.avatars.api(user.address)"/></p>
						<input v-on:keyup.enter="encryptWallet" id="encryptPassword" placeholder="Type a password" type="password"/>
						<input v-on:keyup.enter="encryptWallet" id="encryptPasswordVerify" placeholder="Re-type the password" type="password"/>
						<span class="error">{{error}}</span>
						<button v-on:mousedown="encryptWallet">Register</button>
						<button v-on:mousedown="deleteWallet">Back</button>
					</div>
				</transition>

				<transition name="blobSwitch">
					<div  v-if="state == 'confirmForget'">
						<h1>Are you sure?</h1>
						<p><img v-bind:title="user.address.toLowerCase()" v-on:mousedown="tool = ''" style="cursor:pointer;" class="avatar" v-bind:src="window.avatars.api(user.address)"/> will be forgotten on this machine, and will require a backup to re-use.</p>
						<button v-on:mousedown="state = 'decryptWallet'">Back to login</button>
						<button class="danger slowStart" v-on:mousedown="deleteWallet">Yes, forget me</button>
					</div>
				</transition>
				<transition name="blobSwitch">
					<div v-if="state == 'scanQR'">
						<h1>Scan your QR</h1>
						<video id="qrscan"></video>
						<button v-on:mousedown="state = 'initial'">Back</button>
					</div>
				</transition>
				<transition name="blobSwitch">
					<div v-if="state == 'initial'">
						<h1>Lucid Guide Toolbox</h1>
						<button v-on:mousedown="createWallet">I am new</button>
						<button v-on:mousedown="scanQR">Scan QR</button>
					</div>
				</transition>
			</div>
		</div>
		<div id="qrcode" style="display:none;"></div>
	<script type="text/javascript" src="/js/web3.js"></script>
	<script type="text/javascript" src="/js/wuf.js"></script>
	<script type="text/javascript" src="/js/vue.min.js"></script>
	<script type="text/javascript" src="/js/avatars.js"></script>
	<script type="text/javascript" src="/js/qr.js"></script>
	<script type="module">
		import QrScanner from "/js/qrscan.js";
		QrScanner.WORKER_PATH = '/js/qrscan_worker.js';
		window.QrScanner = QrScanner;
	</script>
	<script type="text/javascript" src="/js/game.js"></script>
	</body>
</html>

<style>
	.error {color:red;}
	header .avatar {
		margin-top:-10px;
	}
	.avatar {
		transition:all .2s;
		font-size:250%;
	}
	header .avatar:hover {
		cursor:default;
		transform:scale(1.4,1.4);
	}
	.solo {
		cursor:default;
	}
</style>